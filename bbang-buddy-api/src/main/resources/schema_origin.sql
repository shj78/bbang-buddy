-- 테이블 삭제 (IF EXISTS 사용)
DROP TABLE IF EXISTS NOTIFICATION CASCADE;
^
DROP TABLE IF EXISTS BBANGPOT_PARTICIPANT CASCADE;
^
DROP TABLE IF EXISTS BBANGPOT CASCADE;
^
DROP TABLE IF EXISTS BBD_USER CASCADE;
^
DROP TABLE IF EXISTS ROLE CASCADE;
^
DROP TABLE IF EXISTS NOTIFICATION;
^

-- 시퀀스 삭제 (IF EXISTS 사용)
DROP SEQUENCE IF EXISTS ROLE_SEQ;
^
DROP SEQUENCE IF EXISTS BBD_USER_SEQ;
^
DROP SEQUENCE IF EXISTS BBANGPOT_SEQ;
^
DROP SEQUENCE IF EXISTS NOTIFICATION_SEQ;
^
DROP SEQUENCE IF EXISTS BBANGPOT_PARTICIPANT_SEQ;
^
-- 시퀀스 생성
CREATE SEQUENCE ROLE_SEQ
    ^
CREATE SEQUENCE BBD_USER_SEQ
    ^
CREATE SEQUENCE BBANGPOT_PARTICIPANT_SEQ
    ^
CREATE SEQUENCE BBANGPOT_SEQ
    ^
CREATE SEQUENCE NOTIFICATION_SEQ
    ^

CREATE TABLE ROLE (
                      ID NUMBER PRIMARY KEY,
                      NAME VARCHAR2(50) NOT NULL UNIQUE,
                      DESCRIPTION CLOB,
                      CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                      UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
    ^

CREATE TABLE BBD_USER (
                          ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                          USERNAME VARCHAR2(50),
                          PASSWORD_HASH VARCHAR2(255),
                          EMAIL VARCHAR2(100),
                          ROLE_ID NUMBER NOT NULL,
                          LAST_LOGIN_AT TIMESTAMP,
                          CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                          UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                          DELETED_AT TIMESTAMP,
                          USER_ID VARCHAR2(50) UNIQUE,
                          UID VARCHAR2(100),
                          PROVIDER VARCHAR2(100),
                          CONSTRAINT FK_BBD_USER_ROLE FOREIGN KEY (ROLE_ID) REFERENCES ROLE(ID)
)
    ^
create table BBANGPOT_PARTICIPANT
(
    BBANGPOT_ID NUMBER(19)         not null,
    BBD_USER_ID VARCHAR2(255 char) not null,
    JOINED_AT   TIMESTAMP(6),
    primary key (BBANGPOT_ID, BBD_USER_ID)
)
    ^
CREATE TABLE BBANGPOT (
                          ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                          TITLE VARCHAR2(255) NOT NULL,
                          ADDRESS VARCHAR2(255 char),
                          DUE_DATE TIMESTAMP NOT NULL,
                          IMAGE_PATH VARCHAR2(255 char),
                          ORIGINAL_FILE_NAME VARCHAR2(255 char),
                          DESCRIPTION CLOB,
                          LATITUDE NUMBER NOT NULL,
                          LONGITUDE NUMBER NOT NULL,
                          MAX_PARTICIPANTS NUMBER NOT NULL,
                          CHAT_ROOM_URL VARCHAR2(255 char),
                          CURRENT_PARTICIPANTS NUMBER DEFAULT 0,
                          CREATED_BY NUMBER NOT NULL,
                          CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                          UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
^
CREATE TABLE NOTIFICATION (
                              ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                              USER_ID VARCHAR(50) NOT NULL,
                              TITLE VARCHAR2(255) NOT NULL,
                              MESSAGE CLOB NOT NULL,
                              IS_READ NUMBER(1) DEFAULT 0,
                              CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                              CONSTRAINT FK_NOTIFICATION_BBDUSER FOREIGN KEY (USER_ID) REFERENCES BBD_USER(USER_ID) ON DELETE CASCADE
);
^